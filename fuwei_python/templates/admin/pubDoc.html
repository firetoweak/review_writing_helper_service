<!DOCTYPE html>
<html>

    {% include "admin/base.html" %}
    <body class="skin-blue">
        <!-- header logo: style can be found in header.less -->
        {% include "admin/header.html" %}
        <div class="wrapper row-offcanvas row-offcanvas-left">
            <aside class="left-side sidebar-offcanvas">
                <!-- sidebar: style can be found in sidebar.less -->
                <section class="sidebar">
                    <!-- Sidebar user panel -->
                    <!-- search form -->
                    <!-- /.search form -->
                    <!-- sidebar menu: : style can be found in sidebar.less -->
                       {% include "admin/menu.html" %}
                </section>
                <!-- /.sidebar -->
            </aside>

            <!-- Right side column. Contains the navbar and content of the page -->
            <aside class="right-side">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        发布文档
                        <small>Preview page</small>
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="#"><i class="fa fa-dashboard"></i> 登录页</a></li>
                        <li class="active">发布文档</li>
                    </ol>
                </section>

                <!-- Main content -->
                <section class="content">
                    <!-- Small boxes (Stat box) -->
                    <div class="row" style="text-align: center;">
                        <div style="display: inline-block; margin: 0 auto; width: 600px;">
                            <div style="float: left;width: 20%;padding-top: 8px">归属文件夹：</div>
                            <div style="float: left;width: 80%">
                                <select id="type" class="form-control">
                                    <option value="0">开发问题管理</option>
                                    <option value="1">产品需求管理</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="text-align: center;">
                        <div style="display: inline-block; margin: 0 auto; width: 600px;">
                            <div style="float: left;width: 20%;padding-top: 3px">上传文件：</div>
                            <div style="float: left;width: 20%">
                                <button type="button" class="layui-btn" id="upload_button">
                                    <i class="layui-icon">&#xe67c;</i>上传文件
                                </button>
                                <input type="hidden" id="file_key" name="file_key">
                            </div>
                            <div style="float: left;width: 50%;margin-top: 10px;text-align: left" id="file_key_show">

                            </div>
                        </div>
                    </div>
                    <div class="row" style="text-align: center;">
                        <div style="display: inline-block; margin: 0 auto; width: 600px;">
                            <div style="float: left;width: 20%;padding-top: 8px">文档名称：</div>
                            <div style="float: left;width: 80%">
                                <input id="file_name" name="file_name" type="text" class="form-control" placeholder="Enter ...">
                            </div>
                        </div>
                    </div>
                    <div class="row" style="text-align: center;margin-top: 15px">
                        <button id="sub" type="button" class="btn btn-primary">提交</button>
                    </div>
                </section>
            </aside>
    </body>
</html>
<script>
    layui.use(['jquery', 'layer','upload'], function(){
        var $ = layui.jquery;
        var upload = layui.upload;
        var uploadInst = upload.render({
            elem: '#upload_button' //绑定元素
            ,url: '/admin/upload' //上传接口
            ,accept: 'file'
            ,exts: 'xls|xlsx|doc|docx|pdf'
            ,before: function(obj){
                layer.load(); //上传loading
            }
            ,done: function(res){
                layer.closeAll();
                alert(res.msg)
                $('#file_key').val(res.tmp_key)
                $('#file_key_show').html(res.show_name)
                return
            }
            ,error: function(){
                //请求异常回调
            }
        });
        $('#sub').click(function () {
            if($('#file_key').val()==""){
                alert("请上传文件")
                return
            }
            if($('#file_name').val()==""){
                alert("请填写文件名称")
                return
            }
            $.ajax({
                url: "/admin/pubDoc",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                data: JSON.stringify({
                    file_key: $('#file_key').val(),
                    type:  $('#type').val(),
                    file_name: $('#file_name').val(),
                }),
                dataType: "json",
                success: function (data) {
                    alert(data.msg);
                    location.href = "/admin/explDoc";
                }
            })
        })
    })
</script>