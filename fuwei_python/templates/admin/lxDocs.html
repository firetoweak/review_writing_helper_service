<!DOCTYPE html>
<html>

{% include "admin/base.html" %}
<body class="skin-blue">
<style>
    .image-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2002;
        background-color: rgba(0, 0, 0, 0.7);
    }
    .image-modal-container {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        max-width: 90%;
        max-height: 90%;
        z-index: 2002;
    }

    .btn-close {
        width: 24px;
        height: 24px;
        background: transparent;
        border: none;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
        position: absolute;
        top: 15px;
        right: 15px;
        z-index: 10;
    }

    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: transparent;
        z-index: 2001;
        display: none;
    }
#lx-content-tb div {
    border-bottom: 1px solid #E9EFF8;
    height: 58px;
    align-items: center;
    display: flex;
    font-family: PingFang SC;
    font-weight: 600;
    font-size: 14px;
    line-height: 22px;
    letter-spacing: 0px;
    text-align: justify;
    font-size: 14px;
    color: #557496;
    padding: 6px;
}
    .shake_show{
        color: #0a53be;
        cursor: pointer;
    }

</style>
<!-- header logo: style can be found in header.less -->
{% include "admin/header.html" %}

<div class="wrapper row-offcanvas row-offcanvas-left">
    <aside class="left-side sidebar-offcanvas">
        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
            <!-- Sidebar user panel -->
            <!-- search form -->
            <!-- /.search form -->
            <!-- sidebar menu: : style can be found in sidebar.less -->
            {% include "admin/menu.html" %}
        </section>
        <!-- /.sidebar -->
    </aside>

    <!-- Right side column. Contains the navbar and content of the page -->
    <aside class="right-side">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                立项评估列表
                <small>Preview page</small>
            </h1>
            <ol class="breadcrumb">
                <li><a href="#"><i class="fa fa-dashboard"></i> 登录页</a></li>
                <li class="active">文档列表</li>
            </ol>
        </section>
        <section class="content">
            <div style="float: left;width: 100%;margin-bottom: 5px">
                <div style="float: left;width: 5%;margin-top: 5px"> <input type="checkbox"  class="icheck-me"><a  id="delete_all" url="/admin/lx_batch_delete" style="cursor: pointer">删除选中</a></div>
                <div  style="float: left;width: 10%">
<!--                    <select id="type" class="form-control">-->
<!--                        <option value="-1">全部类型</option>-->
<!--                        <option value="0" {% if type==0 %} selected {% endif %}>缺陷管理</option>-->
<!--                        <option value="1"  {% if type==1 %} selected {% endif %}>需求管理</option>-->
<!--                    </select>-->
                </div>
                <div style="float: left;width: 15%;margin-left: 10px">
                    <input id="user_name" name="user_name" class="form-control" placeholder="用户名:邮件/手机号码" value="{{user_name}}">
                </div>
                <div style="float: left;width: 20%; margin-left: 5px">
                    <button id="sub" type="button" class="btn btn-primary">搜索</button>
                </div>
            </div>
        </section>

        <section class="content"  id="tb">
            {% for item in items %}
            <div class="box-body" id="ai-val-tr">
                <input type="checkbox" name="ids" value="{{item[0].id}}">
                ID: {{item[0].id}} &nbsp;&nbsp;&nbsp;  &nbsp;
                标题： <a href="/admin/report?id={{item[0].id}}" target="_blank" style="color: #0a53be">{{item[0].title}}</a> &nbsp;&nbsp;&nbsp;  &nbsp;
                附件： <a class="download_attr" file_key="{{item[0].file_key}}" style="cursor: pointer">{{item[0].file_name}}</a> &nbsp;&nbsp;&nbsp;  &nbsp;
                用户: {% if item[1].admin_user_id==0 %} {{item[1].mobile}} {%else %} {{item[1].email}} {% endif %}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;创建时间：{{item[0].create_time}}&nbsp;<a class="shake_show" data-id="{{item[0].id}}">评分日志</a>
                <div style="float: left;width: 100%;display: none" id="shake_log_{{item[0].id}}">
                    <b style="color: red">评分日志</b><br>{{item[0].log_content|safe}}{% if item[0].log_content==""  %} 无 {% endif %}
                </div>
                <table class="table table-bordered" id="lx-content-tb">
                    <thead>
                    <tr>
                        <th style="width: 15%;">立项类型</th>
                        <th style="width: 10%;">是否首次立项</th>
                        <th style="width: 13%;">不同视角评分 </th>
                        <th style="width: 10%;">评分 (满分10分)</th>
                        <th style="width: 52%;">总体评价</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr >
                        <td>
                            <P>市场机会/威胁分析驱动型立项</P>
                        </td>
                        <td>
                            <p>首次立项</p>
                        </td>
                        <td style="padding: 0;">
                            <div>
                                市场机会分析工作质量
                            </div>
                            <div>
                                产品价值设定工作质量
                            </div>
                            <div>
                                产品包定义工作质量
                            </div>
                            <div>
                                产品执行策略工作质量
                            </div>
                            <div>
                                投资收益分析工作质量
                            </div>
                            <div>
                                产品立项整体工作质量
                            </div>
                        </td>
                        <td  style="padding: 0">
                            <div>
                                <span class="score score-green">{{item[0].step_1_score}}</span>
                            </div>
                            <div>
                                <span class="score score-blue">{{item[0].step_2_score}}</span>
                            </div>
                            <div>
                                <span class="score score-purple">{{item[0].step_3_score}}</span>
                            </div>
                            <div>
                                <span class="score score-red">{{item[0].step_4_score}}</span>
                            </div>
                            <div>
                                <span class="score score-yellow">{{item[0].step_5_score}}</span>
                            </div>
                            <div>
                                <span class="score score-pink">{{item[0].total_score}}</span>
                            </div>
                        </td>
                        <td style="text-align: center">
                            <div style="height: 324px;width: 100%;overflow-y: scroll;align-items:start">
                                立项工作实际上处在的阶段:{{caseTextList[item[0].case]|safe}}<br>
                                下阶段工作重点:{{item[0].summarize_val_sug|safe}}
                            </div>
                        </td>
                    </tr>
                    </tbody>

                </table>
            </div>
            {% endfor %}
            <ul class="pagination pagination-sm no-margin pull-right">
                {{ pagination.links }}
            </ul>
        </section>
    </aside>
</body>
<!-- 登录弹框背景遮罩 -->
<div class="modal-overlay" id="modalOverlay"  ></div>
<!-- 图片放大模态框 -->
<div class="image-modal" id="imageModal">
    <div class="image-modal-container">
        <button type="button" class="btn-close" id="closeImageModal">
            X
        </button>
        <div class="image-modal-content">
            <img src="" alt="放大图片">
        </div>
    </div>
</div>
</html>

<script src="{{ url_for('static', filename='admin/js/common.js')}}" type="text/javascript"></script>
<script>
    $(function () {
        $('#sub').click(function () {
            location.href = "/admin/lxDocs?user_name=" + $('#user_name').val()+"&type={{type}}";
        })

        $('#ai-val-tr img').css('cursor', 'pointer').click(function() {
            const imgSrc = $(this).attr('src');
            $('#imageModal img').attr('src', imgSrc);
            $('#imageModal').fadeIn(300);
            $('body').css('overflow', 'hidden');
        });

        // $('.btn-close, #modalOverlay').on('click', function() {
        //     $('#imageModal, #modalOverlay').fadeOut(300);
        //     $('body').css('overflow', '');
        // });

        const $modal = $('#imageModal');
        const $modalContainer = $('.image-modal-container');
        const $closeButton = $('#closeImageModal');

        // 点击关闭按钮时关闭模态框
        $closeButton.on('click', function() {
            $modal.hide();
        });

        // 点击模态框外部时关闭模态框
        $(document).on('click', function(event) {
            if (!$modalContainer.is(event.target) && $modalContainer.has(event.target).length === 0 && $modal.is(event.target)) {
                $modal.hide();
            }
        });


        $('.download_attr').on('click', function() {
            window.open('/admin/lxDocs?type={{g.type}}&act=download&file_key='+$(this).attr('file_key'))
            layer.closeAll()
        })
        $('.shake_show').click(function (){
            if($('#shake_log_'+$(this).attr("data-id")).css('display') === 'none'){
                $('#shake_log_'+$(this).attr("data-id")).show()
            }else{
                $('#shake_log_'+$(this).attr("data-id")).hide()
            }
        })

    })
</script>