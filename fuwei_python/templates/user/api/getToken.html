<!DOCTYPE html>
<html>
    {% include "user/base.html" %}
    <body class="skin-blue">
        <!-- header logo: style can be found in header.less -->
        {% include "components/header.html" %}
        <div class="wrapper row-offcanvas row-offcanvas-left">

            <!-- Right side column. Contains the navbar and content of the page -->
            <aside class="right-side strech">
                <!-- Content Header (Page header) -->
                <section class="content-header">
                    <h1>
                        API管理
                        <small>Preview page</small>
                    </h1>
                    <ol class="breadcrumb">
                        <li><a href="/user/index"><i class="fa fa-dashboard"></i> 首页</a></li>
                        <li class="active"><a href="/user/aiValList?type={{type}}">{{type_content}}评估</a></li>
                        <li class="active">API管理</li>
                    </ol>
                </section>
                <!-- Main content -->
                <section class="content">
                    <div class="row" style="text-align: left;width: 100%;font-size: 20px">
                        <b>访问token：</b>{{token}}  <button id="rebuild" type="button" class="btn btn-danger">重新生成</button>
                    </div>
                </section>

                <section class="content">

                    <div class="row" style="text-align: left;width: 60%;">
                        <b>{{type_content}}API--评估内容发送（接口1）</b>
                        <pre class="layui-code">
curl --request POST \
  --url http://{{domain}}/user/api/ai_val \
  --header 'Cache-Control: no-cache' \
  --header 'Content-Type: application/json' \
  --header 'Host: {{domain}}' \
  --connect-timeout 300\
  --data '{
    "service_type":0,
    "async": true,
    "items":["aaaa","bbbb","cccc","dddd"],
    "token":"{{token}}"
}'
#################请求中data参数解释#############
{
    "service_type":{{type}},  //服务类型,默认为0为缺陷评估，1为需求管理评估
    "async": true,  //是否异步返回评估结果，当为false时，请求实时返回评估结果；当为true时候需在接口2中获取评估结果
    "items":["aaaa","bbbb","cccc","dddd"], // 评估项：{% if type==0 %}[产品缺陷描述,原因分析,解决措施实施,回归测试] ;必须依序填写{%else%} "items":["aaaa","bbbb","cccc","dddd"], //评估项：[需求描述,需求分析,需求决策,验证结果] ;必须依序填写 {% endif %}
    "token":"{{token}}"   //身份标识token
}
################返回数据解析#####################
{
	"code": 0,  //结果码 1：成功并完成 ，0：成功未完成，-1：失败
	"items": [], //评估结果，当请求时async==true，返回为空；当async==false，返回：{% if type==0 %}[[产品缺陷描述评估依据,产品缺陷描述评估得分],[原因分析评估依据,原因分析得分],[解决措施实施评估依据,解决措施实施评估得分],[回归测试评估依据,回归测试评估得分]]{%else%}[[需求描述述评估依据,需求描述评估得分],[需求分析评估依据,需求分析得分],[需求决策评估依据,需求决策评估得分],[验证结果评估依据,验证结果评估得分]]{% endif %}
	"msg": "AI评估进行中,请稍后根据record_id发请求查看评估结果",  //系统提示信息
	"record_id": "202505031044508447931"  //评估记录id，接口2请求的时候会用上
}

                        </pre>
                    </div>

                    <div class="row" style="text-align: left;width: 60%;">
                        <b>{{type_content}}API--获取评估结果（接口2）</b>
                        <pre class="layui-code">
curl --request POST \
  --url http://{{domain}}/user/api/ai_val \
  --header 'Cache-Control: no-cache' \
  --header 'Content-Type: application/json' \
  --header 'Host: {{domain}}' \
  --connect-timeout 10\
  --data '{
    "record_id": "202505022234103798751",
    "token":"{{token}}"
}'
#################请求中data参数解释#############
{
    "record_id": "202505022234103798751",  //接口1中的返回数据
    "token":"{{token}}"  //身份标识token
}
#################返回数据解析###################
{
	"code": 0,  //结果码 1：成功并完成 ，0：成功未完成，-1：失败
	"items": [], //依序返回[[产品缺陷描述评估依据,产品缺陷描述评估得分],[原因分析评估依据,原因分析得分],[解决措施实施评估依据,解决措施实施评估得分],[回归测试评估依据,回归测试评估得分]]
	"msg": "AI评估进行中,请稍后根据record_id发请求查看评估结果",  //系统提示信息
	"record_id": "202505031044508447931"  //评估记录id，接口3会用上
}

                        </pre>
                    </div>
                    <div class="row" style="text-align: left;width: 60%;">
                        <b>{{type_content}}API--对评估结果提问（接口3）</b>
                        <pre class="layui-code">
curl --request POST \
  --url http://{{domain}}/user/api/ai_question \
  --header 'Cache-Control: no-cache' \
  --header 'Content-Type: application/json' \
  --header 'Host: {{domain}}' \
  --connect-timeout 300\
  --data '{
    "ai_score_id":"202505022234103798751",
    "question":"尼玛，怎么全部都是0分",
    "async": false,
    "token":"{{token}}"
}'
#################请求中data参数解释#############
{
    "ai_score_id":"202505022234103798751",   //与接口1、接口2中的返回结果的record_id对应
    "question":"尼玛，怎么全部都是0分",  //问题
    "async": false,  //是否异步返回AI回答，当为false时，请求实时返回AI回答；当为true时候需在接口4中获取AI回答
    "token":"{{token}}"
}
################返回数据解析#####################
{
	"answer": "",  //ai对问题的回答，请求时候如果async==false，answer为空需在接口4中获取AI回答
	"code": 0,   //结果码 1：成功并完成 ，0：成功未完成，-1：失败
	"msg": "您的问题AI大模型正在思考中，请稍后",  //系统提示信息
	"val_ai_aq_id": 3  //AI问答记录id，接口4请求的时候会用上
}
                        </pre>
                    </div>
                    <div class="row" style="text-align: left;width: 60%;">
                        <b>{{type_content}}API--对评估结果提问（接口4）</b>
                        <pre class="layui-code">
curl --request POST \
  --url http://{{domain}}/user/api/ai_question \
  --header 'Cache-Control: no-cache' \
  --header 'Content-Type: application/json' \
  --header 'Host: {{domain}}' \
  --connect-timeout 10\
  --data '{
    "val_ai_aq_id":2,
    "token":"{{token}}"
}'
#################请求中data参数解释#############
{
    "val_ai_aq_id":2,  //与接口3返回数据中的val_ai_aq_id对应
    "token":"{{token}}"     //身份标识token
}
################返回数据解析#####################
{
	"answer": "",  //AI对接口3中提问的回答
	"code": 1,   //结果码 1：成功并完成 ，0：成功未完成，-1：失败
	"msg": "回复成功"   //系统提示信息
}
                        </pre>
                    </div>

                </section>

            </aside>
    </body>
</html>
<script>
    layui.use('code', function(){
        layui.code({
            elem: 'pre', //默认值为.layui-code
            title:'CURL代码'
        });
        $('#rebuild').click(function(){
                $.ajax({
                    url: "/user/api/get_token",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    success: function (data) {
                        alert(data.msg);
                        location.reload();
                    }
                })
        })
        // var $ = layui.jquery;
        // var upload = layui.upload;
        // var uploadInst = upload.render({
        //     elem: '#upload_button' //绑定元素
        //     ,url: '/admin/upload' //上传接口
        //     ,accept: 'file'
        //     ,exts: 'xls|xlsx|doc|docx|pdf'
        //     ,before: function(obj){
        //         layer.load(); //上传loading
        //     }
        //     ,done: function(res){
        //         layer.closeAll();
        //         alert(res.msg)
        //         $('#file_key').val(res.tmp_key)
        //         $('#file_key_show').html(res.show_name)
        //         return
        //     }
        //     ,error: function(){
        //         //请求异常回调
        //     }
        // });
        // $('#sub').click(function () {
        //     $.ajax({
        //         url: "/user/inner/add",
        //         type: "POST",
        //         contentType: "application/json;charset=UTF-8",
        //         data: JSON.stringify({
        //             real_name: $('#real_name').val(),
        //             email: $('#email').val(),
        //             dept:$('#dept').val(),
        //             position:$('#position').val(),
        //             password:$('#password').val()
        //         }),
        //         dataType: "json",
        //         success: function (data) {
        //             alert(data.msg);
        //             location.reload();
        //         }
        //     })
        // })
    })
</script>