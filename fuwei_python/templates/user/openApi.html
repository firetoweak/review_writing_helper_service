<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI评估 - 锋矢AI蓝军</title>
    {% include "user/base.html" %}
    <style>
        body {
            font-family: 'PingFang SC', sans-serif;
            color: #222222;
        }
        

        .footer {
            padding: 16px 0 20px;
            margin-top: 100px;
        }
        
        .footer-divider {
            height: 1px;
            background-color: #E9E9E9;
            width: 100%;
            max-width: 1278px;
            margin: 0 auto;
            opacity: 0.7;
        }
        
        
        .company-name {
            color: #217EFD;
        }
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: transparent;
            z-index: 1000;
            transition: background-color 0.3s ease;
        }

        .header.header-scrolled {
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        /* 代码块样式 */
        .code-block-container {
            background-color: #FFFFFF;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding-bottom: 10px;
            border-bottom: 1px solid #EEEEEE;
            background-color: #E5F0FD;
            border-radius: 8px 8px 0 0;
            padding: 10px 15px;
        }
        
        .code-title {
            font-family: 'PingFang SC', sans-serif;
            font-weight: 500;
            font-size: 16px;
            color: #217EFD;
        }
        
        .code-actions {
            display: flex;
            align-items: center;
        }
        
        .copy-btn {
            display: flex;
            align-items: center;
            background: none;
            border: none;
            color: #666666;
            font-size: 14px;
            cursor: pointer;
        }
        
        .copy-btn img {
            margin-right: 5px;
        }
        
        .code-content {
            position: relative;
            background-color: #F6FAFF;
            border-radius: 0 0 6px 6px;
            max-height: 500px;
            overflow: auto;
        }
        
        pre.line-numbers {
            position: relative;
            padding-left: 3.8em;
            counter-reset: linenumber;
            margin: 0;
            white-space: pre-wrap;
            font-family: 'Menlo', 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            color: #333333;
            overflow: hidden;
        }
        
        pre.line-numbers > code {
            position: relative;
            display: block;
            padding: 0 15px 0 0;
            overflow: visible;
        }
        
        .line-numbers .line-numbers-rows {
            position: absolute;
            pointer-events: none;
            top: 0;
            left: 0;
            width: 3.2em;
            letter-spacing: -1px;
            border-right: 1px solid #ddd;
            user-select: none;
            background-color: rgba(220, 230, 240, 0.3);
            height: 100%;
        }
        
        .line-numbers-rows > span {
            display: block;
            counter-increment: linenumber;
            line-height: 1.5;
            padding-top: 1px;
            font-size: 12px;
        }
        
        .line-numbers-rows > span:before {
            content: counter(linenumber);
            color: #888;
            display: block;
            padding-right: 0.8em;
            text-align: right;
        }
        
        /* JSON语法高亮 */
        .language-json .token.property {
            color: #2E86C1;
        }
        
        .language-json .token.string {
            color: #27AE60;
        }
        
        .language-json .token.number,
        .language-json .token.boolean {
            color: #E74C3C;
        }
        
        .language-json .token.null {
            color: #9B59B6;
        }

        .no-wrap-text {
            white-space: nowrap !important;
            overflow-x: auto;
        }
        
        /* right-menu样式 */
        .right-menu {
            color: #557496;
            padding: 15px 0px;
            position: absolute;
            right: 5%;
            top: 400px; 
            background-color: white;  
            border: 1px solid #f3f0f0;
            border-radius: 8px;
            height: 149px;
            width: 94px;
            font-family: PingFang SC;
            font-weight: 400;
            font-size: 12px;
            line-height: 18px;
            letter-spacing: 0%;
            z-index: 900;
            transition: all 0.3s ease;
        }
        
        .right-menu.fixed {
            position: fixed;
            top: 80px; /* 距离顶部的距离，应该大于header的高度 */
        }
        
        .right-menu div {
            height: 20%;
            width: 80%;
            float: left;
            padding: 0px 0px 0px 10px;
            margin-bottom: 10px;
            z-index: 20;
            position: relative;
            cursor: pointer;
        }
        
        .right-menu .right-menu-active {
            height: 100%;
            width: 20%;
            float: left; 
            border-right: 1px solid #C0D7F4;
        }
        
        .right-menu-active-img {
            margin-right: 0px;
            position: absolute;
            left: -6%;
            margin-top: 3%;
        }
    </style>
</head>
<body>
    <!-- 顶部导航栏 -->

    {% if welcomePage==1 %}
    <header class="header">
        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <a class="navbar-brand d-flex align-items-center" href="/"  >
                    <img src="/static/images/logo-icon.svg" alt="锋矢科技" class="logo-icon">
                    <img src="/static/images/logo-text.svg" alt="锋矢科技" class="logo-text ms-2">
                </a>

                <div class="d-flex align-items-center ms-auto" style="position: relative;">
                    <ul class="navbar-nav me-4">
                        <li class="nav-item">
                            <a class="nav-link" href="/" >首页</a>
                        </li>
                        <li class="nav-item ms-3">
                            <a class="nav-link" id="contactUsLink">联系我们</a>
                        </li>
                    </ul>
                </div>

            </div>
        </nav>
    </header>
    <div class="modal-overlay" id="modalOverlay"></div>
    <div class="contact-modal" id="contactModal" >
        <div class="contact-container" style="background-image: url(/static/images/link_us.png); background-repeat: no-repeat; background-position: center top; background-size: 100% 100%;">
            <div class="contact-header">
                <button type="button" class="btn-close" id="closeContactModal" style="top: 16px;right: 16px;">
                    <img src="/static/images/register/register-close-icon.svg" alt="关闭">
                </button>
            </div>
        </div>
    </div>
    {% else %}
    {% include "components/header.html" %}
    {% endif %}

    <!-- 右侧导航菜单
    <div class="right-menu">
        <div class="right-menu-active"></div>
        <div onclick="rightMenuLocation('api1', this)">
            <img class="right-menu-active-img" src=/static/imagesaival/left-tag.svg" alt="">
            接口1
        </div>
        <div onclick="rightMenuLocation('api2', this)">接口2</div>
        <div onclick="rightMenuLocation('api3', this)">接口3</div>
        <div onclick="rightMenuLocation('api4', this)">接口4</div>
    </div>
-->
    <!-- 顶部横幅 -->
    <section class="banner" style="position: relative;">
        <div class="banner-content">
            <div class="d-flex align-items-center mb-3">
                <h1 class="banner-title mb-0">API管理</h1>
                <img src="/static/images/aival/3star.png" alt="" style="margin-bottom: 35px;margin-left: 10px">
            </div>
            <p class="banner-subtitle">提供API接口，生成访问token</p>
            <div style="width: 380px;height: 300px;position: absolute;right: 10%;top: 20%;">
                <img src="/static/images/aival/banner5.png" alt="">
            </div>
        </div>
    </section>

    <!-- 主要内容区域 -->
    <div class="container-fluid" style="max-width: 1280px; margin-top: 20px;">
        <!-- 面包屑导航 -->
        <nav aria-label="breadcrumb">
            {% if welcomePage==1 %}
            <li class="breadcrumb-item">
                <a href="/open_api?type=0"  {% if type!='0' %} style="color: blue" {% endif %} >缺陷管理</a>|
                <a href="/open_api?type=1"  {% if type!='1' %} style="color: blue" {% endif %}>产品管理</a>|
                <a href="/open_api?type=2"  {% if type!='2' %} style="color: blue" {% endif %}>立项管理</a>
            </li>
            {% else %}
            <ol class="breadcrumb breadcrumb-custom">
                <li class="breadcrumb-item"><a href="/user/index">首页</a></li>
                <li class="breadcrumb-item"><a href="{{g.type_list_url}}?type={{g.type}}">{{g.type_content}}评估记录</a></li>
                <li class="breadcrumb-item active">API管理</li>
            </ol>
            {% endif %}
        </nav>
    </div>
    {% if welcomePage!=1 %}
    <div class="container-fluid" style="max-width: 1280px; margin-top: 20px;font-family: PingFang SC;font-weight: 600;font-size: 24px;line-height: 36px;letter-spacing: 0%;vertical-align: middle;">
        <img src="/static/images/fengchi_tag.svg" alt="" style="margin-right: 10px;"><b>访问token：</b>{% if token==""  %}  暂无 {% else %}  {{token}}  {% endif %}  <button id="rebuild" type="button" class="btn btn-danger" style="background: linear-gradient(90deg, #9767FF 0%, #217EFD 50%);border-color:rgba(255, 0, 0, 0);">生成新token</button>
    </div>
    {% endif %}
    <div class="container-fluid" style="max-width: 1280px; margin-top: 20px;font-family: PingFang SC;font-weight: 600;font-size: 24px;line-height: 36px;letter-spacing: 0%;vertical-align: middle;">
        <img src="/static/images/fengchi_tag.svg" alt="" style="margin-right: 10px;"><span id="api1">API功能：{{g.type_content}}评估，如下图页面功能</span>
    </div>
    <div class="container-fluid" style="margin: 0 auto;width: 1280px;">
        <img src="/static/images/aival/type_{{g.type}}.png" style="width: 70%">
    </div>
    <div class="container-fluid" style="font-size: 18px;margin: 0 auto;width: 1280px;"> 通过API实现此功能有两种方式：</div>
    <div class="container-fluid" style="font-size: 15px;margin: 0 auto;width: 1280px;"> 一、调用<a href="#api1" style="color: blue;">接口1</a>直接等待评估结果，评估结果同步返回</div>
    <div class="container-fluid" style="font-size: 15px;margin: 0 auto;width: 1280px;"> 二、调用<a href="#api1" style="color: blue;">接口1</a>后不等待AI评估结果，直接返回评估数据的记录id；等待2-6分钟后请求<a href="#api2" style="color: blue;">接口2</a>获取评估结果，评估结果异步返回</div>
    <div class="container-fluid" style="font-size: 13px;margin: 0 auto;width: 1280px;"> 调用接口1的时候通过参数async控制接口是否同步返回评估结果</div>

        

    <div class="container-fluid" style="max-width: 1280px; margin-top: 20px;font-family: PingFang SC;font-weight: 600;font-size: 24px;line-height: 36px;letter-spacing: 0%;vertical-align: middle;">
        <img src="/static/images/fengchi_tag.svg" alt="" style="margin-right: 10px;"><span id="api1">{{g.type_content}}API--评估内容发送（接口1）</span>
    </div>
    <div class="container-fluid" style="max-width: 1280px; margin-top: 20px;">
        <div class="code-block-container p-0">
            <div class="d-flex align-items-center">
                <div class="code-header">
                    <span class="code-title"></span>
                    <div class="code-actions">
                        <button class="copy-btn" onclick="copyCodeToClipboard(this)">
                            <img src="/static/images/copy-icon.svg" alt="复制" class="copy-icon">
                            <span>复制</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="code-content">
                <pre class="line-numbers"><code class="language-json">
{% if  type==0 or type==1 %}
curl --request POST \
  --url {{domain}}/user/api/ai_val \
  --header 'Cache-Control: no-cache' \
  --header 'Content-Type: application/json' \
  --header 'Host: {{domain}}' \
  --connect-timeout 300\
  --data '{
    "service_type":0,
    "async": true,
    "items":["aaaa","bbbb","cccc","dddd"],
    "token":"{% if welcomePage!=1 %}{% if token==""  %}暂无{% else %}{{token}}{% endif %}{% else %}身份标识token{% endif %}"
}'
#################请求中data参数解释#############
{
    "service_type":{{type}},  //服务类型,默认为0为缺陷评估，1为需求管理评估
    "async": true,  //是否异步返回评估结果，当为false时，请求实时返回评估结果；当为true时候需在接口2中获取评估结果
    "items":["aaaa","bbbb","cccc","dddd"], // 评估项： "items":["aaaa","bbbb","cccc","dddd"], //评估项：[需求描述,需求分析,需求决策,验证结果] ;必须依序填写 评估项内数据可以是html标签，如果有图片必须是可以被外网访问链接的img标签或者是base_encode64数据格式的img标签
    "token":"{% if welcomePage!=1 %}{% if token==""  %}暂无{% else %}{{token}}{% endif %}{% else %}身份标识token{% endif %}"   //身份标识token
}
################返回数据解析#####################
{
	"code": 0,  //结果码 1：成功并完成 ，0：成功未完成，-1：失败
	"items": [], //评估结果，当请求时async==true，返回为空；当async==false，返回：[[需求描述述评估依据,需求描述评估得分],[需求分析评估依据,需求分析得分],[需求决策评估依据,需求决策评估得分],[验证结果评估依据,验证结果评估得分]]
	"msg": "AI评估进行中,请稍后根据record_id发请求查看评估结果",  //系统提示信息
	"record_id": "202505031044508447931"  //评估记录id，接口2请求的时候会用上
}
{% else %}

curl --request POST \
  --url {{domain}}/user/api/lx_upload_doc_deal \
  --header 'Accept: */*' \
  --header 'Accept-Encoding: gzip, deflate, br' \
  --header 'Connection: keep-alive' \
  --header 'User-Agent: PostmanRuntime-ApipostRuntime/1.1.0' \
  --header 'content-type: multipart/form-data' \
  --form 'file=@/path/to/real/file.pdf' \
  --form drive_source=1 \
  --form lx_time=0 \
  --form token={% if welcomePage!=1 %}{% if token==""  %}暂无{% else %}{{token}}{% endif %}{% else %}身份标识token{% endif %} \
  --form 'title=立项标题' \
  --form service_type=3 \
  --form async=true
#################请求中form参数解释#############
  --form 'file=@/path/to/real/file.pdf'    //key值为file,在本地以multipart/form-data方式上传的的文件，只允许pdf，docx、doc、ppt、pptx
  --form drive_source=1                    // 驱动源类型： 1:市场机会分析,2:产品价值设定,3:产品包定义,4:产品执行策略,5:投资收益分析
  --form lx_time=0                         //首次立项还是迭代立项 0：首次，1：迭代
  --form token={% if welcomePage!=1 %}{% if token==""  %}暂无{% else %}{{token}}{% endif %}{% else %}身份标识token{% endif %}    //身份标识
  --form 'title=立项标题' \                //立项标题
  --form service_type=3                    //服务类型，这里默认为3
  --form async=true                        //是否异步返回评估结果，当为false时，请求实时返回评估结果；当为true时候需在接口2中获取评估结果

  ################返回数据解析#####################
{
    "item_total": [],  //  立项总评结果，当请求时async==true，返回为空；当async==false，返回： [总评结论,总评分数]
	"code": 0,  //结果码 1：成功并完成 ，0：成功未完成，-1：失败
	"msg": "AI评估进行中,请稍后根据record_id发请求查看评估结果",  //系统提示信息
	"record_id": "202505031044508447931"  //评估记录id，接口2请求的时候会用上
   	"items": [],
    //评估结果，当请求时async==true，返回为空；当async==false，返回：[[市场机会/威胁识别工作输出,市场机会/威胁识别评估依据,市场机会/威胁识别评估得分],[产品价值设定工作输出, 产品价值设定评估依据,产品价值设定分析得分],[需求决策评估依据,需求决策评估得分],[产品包自定义工作输出,产品包自定义评估依据,产品包自定义评估得分],[产品执行策略工作输出,产品执行策略评估依据,产品执行策略评估得分],[投资收益分析工作输出,投资收益分析评估依据,投资收益分析评估得分]]
}
{% endif %}


</code>
</pre>
            </div>
        </div>
    </div>

    <div class="container-fluid" style="max-width: 1280px; margin-top: 20px;font-family: PingFang SC;font-weight: 600;font-size: 24px;line-height: 36px;letter-spacing: 0%;vertical-align: middle;">
        <img src="/static/images/fengchi_tag.svg" alt="" style="margin-right: 10px;"><span id="api2">{{g.type_content}}API--获取评估结果（接口2）</span>

    </div>
    <div class="container-fluid" style="max-width: 1280px; margin-top: 20px;">
        <div class="code-block-container p-0">
            <div class="d-flex align-items-center">
                <div class="code-header">
                    <span class="code-title"></span>
                    <div class="code-actions">
                        <button class="copy-btn" onclick="copyCodeToClipboard(this)">
                            <img src="/static/images/copy-icon.svg" alt="复制" class="copy-icon">
                            <span>复制</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="code-content">
                <pre class="line-numbers">
<code class="language-json">
{% if  type==0 or type==1 %}
curl --request POST \
--url {{domain}}/user/api/ai_val \
--header 'Cache-Control: no-cache' \
--header 'Content-Type: application/json' \
--header 'Host: {{domain}}' \
--connect-timeout 10\
--data '{
  "record_id": "202505022234103798751",
  "token":"{% if welcomePage!=1 %}{% if token==""  %}暂无{% else %}{{token}}{% endif %}{% else %}身份标识token{% endif %}"
}'
#################请求中data参数解释#############
{
  "record_id": "202505022234103798751",  //接口1中的返回数据
  "token":"{% if welcomePage!=1 %}{% if token==""  %}暂无{% else %}{{token}}{% endif %}{% else %}身份标识token{% endif %}"  //身份标识token
}
#################返回数据解析###################
{
  "code": 0,  //结果码 1：成功并完成 ，0：成功未完成，-1：失败
  "items": [], //依序返回[[产品缺陷描述评估依据,产品缺陷描述评估得分],[原因分析评估依据,原因分析得分],[解决措施实施评估依据,解决措施实施评估得分],[回归测试评估依据,回归测试评估得分]]
  "msg": "AI评估进行中,请稍后根据record_id发请求查看评估结果",  //系统提示信息
  "record_id": "202505031044508447931"  //评估记录id，接口3会用上
}
{% else %}
curl --request GET \
  --url {{domain}}/user/api/get_ai_lx \
  --header 'Accept: */*' \
  --header 'Accept-Encoding: gzip, deflate, br' \
  --header 'Connection: keep-alive' \
  --header 'Content-Type: application/json' \
  --header 'User-Agent: PostmanRuntime-ApipostRuntime/1.1.0' \
  --data '{
    "record_id": "56",
    "token":"9a921519f01480574858a8b5f31d0a88"
}'

#################请求中data参数解释#############
{
  "record_id": "202505022234103798751",  //接口1中的返回数据
  "token":"{% if welcomePage!=1 %}{% if token==""  %}暂无{% else %}{{token}}{% endif %}{% else %}身份标识token{% endif %}"  //身份标识token
}
#################返回数据解析###################
{
    "item_total": [],  //  立项总评结果，当未完成评估时，返回为空；完成评估，返回： [总评结论,总评分数]
	"code": 0,  //结果码 1：成功并完成 ，0：成功未完成，-1：失败
	"msg": "AI评估进行中,请稍后根据record_id发请求查看评估结果",  //系统提示信息
	"record_id": "99"  //评估记录id
   	"items": [],
    //评估结果，当未完成评估时，返回为空；完成评估，返回：
    // [[市场机会/威胁识别工作输出,市场机会/威胁识别评估依据,市场机会/威胁识别评估得分],[产品价值设定工作输出, 产品价值设定评估依据,产品价值设定分析得分],[需求决策评估依据,需求决策评估得分],[产品包自定义工作输出,产品包自定义评估依据,产品包自定义评估得分],[产品执行策略工作输出,产品执行策略评估依据,产品执行策略评估得分],[投资收益分析工作输出,投资收益分析评估依据,投资收益分析评估得分]]
}
{% endif %}
</code>
</pre>
            </div>
        </div>
    </div>

    <div class="modal fade" id="rebuildConfirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="max-width:400px;">
            <div class="modal-content" style="border-radius:16px;width: 80%;height: 210px;background: linear-gradient(180deg, #E1DEFF 1.97%, #FFFFFF 27.61%);padding: 0 20px;">
                <div style="position: absolute;right: 45%;top:-12%"><img src="/static/images/logo-icon.svg" alt="锋矢科技" class="logo-icon"></div>
                <div class="text-center">
                    <div style="font-size:15px;font-weight:400;color:#222;margin-bottom:8px;margin-top: 50px;">执行此操作将会为您提供一个新的token，原有的token将不继续生效，请确认是否执行此操作？</div>
                    <div class="d-flex justify-content-center gap-3" style="margin-top: 40px;">
                        <button type="button" class="btn btn-light" data-bs-dismiss="modal" style="min-width:100px;border-radius:8px;">取消</button>
                        <button type="button" class="btn btn-danger" id="continueRebuild"  url="/user/inner/batch_delete?type={{g.type}}" style="min-width:100px;border-radius:8px;background:linear-gradient(90deg,#9767FF 0%,#217EFD 100%);border:none;">继续执行</button>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- 底部区域 -->

    {% include "user/footer.html" %}
    {% include "user/base_js.html" %}
    {% include "user/base_toast.html" %}
    <script>
        // 全局函数，用于页面导航
        function rightMenuLocation(id, clickedElement) {
            // 获取被点击的div元素
            var menuItem = clickedElement || this;
            
            // 输出被点击的元素信息，便于调试
            console.log('被点击的菜单项:', menuItem);
            
            // 处理右侧菜单的active状态
            // 首先移除所有菜单项中的图标
            $('.right-menu div .right-menu-active-img').remove();
            
            // 然后在当前点击的菜单项中添加图标
            if (!$(menuItem).find('.right-menu-active-img').length) {
                $(menuItem).prepend('<img class="right-menu-active-img" src=/static/imagesaival/left-tag.svg" alt="">');
            }
            
            // 滚动到目标元素
            var targetElement = document.getElementById(id);
            if (targetElement) {
                // 先滚动到元素位置
                targetElement.scrollIntoView({ behavior: 'smooth' });
                
                // 滚动完成后再向上偏移70px
                setTimeout(function() {
                    window.scrollBy({
                        top: -70, // 向上偏移70px，适应header高度和视觉舒适度
                        behavior: 'smooth'
                    });
                }, 500); // 等待滚动完成再执行偏移
            } else {
                console.error('元素不存在：' + id);
            }
        }
        
        // 获取元素在滚动时的位置和高度信息
        function getElementScrollInfo(elementSelector) {
            const element = document.querySelector(elementSelector);
            if (!element) {
                console.error('找不到元素：' + elementSelector);
                return null;
            }
            
            // 获取元素的位置信息
            const rect = element.getBoundingClientRect();
            
            // 计算元素相对于文档顶部的距离
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const absoluteTop = rect.top + scrollTop;
            
            // 返回元素的各种位置信息
            return {
                // 元素相对于视口的位置
                top: rect.top,
                bottom: rect.bottom,
                left: rect.left,
                right: rect.right,
                
                // 元素的尺寸
                width: rect.width,
                height: rect.height,
                
                // 元素相对于文档顶部的绝对位置
                absoluteTop: absoluteTop,
                absoluteBottom: absoluteTop + rect.height,
                
                // 元素是否在视口中可见
                isVisible: (
                    rect.top >= 0 &&
                    rect.left >= 0 &&
                    rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
                    rect.right <= (window.innerWidth || document.documentElement.clientWidth)
                ),
                
                // 元素顶部是否已经滚动出视口
                isTopVisible: rect.top >= 0,
                
                // 元素在视口中可见的部分
                visibleHeight: Math.min(rect.bottom, window.innerHeight) - Math.max(rect.top, 0)
            };
        }

        $(document).ready(function() {

            // 简单的JSON语法高亮
            function highlightJson() {
                const codeBlocks = document.querySelectorAll('code.language-json');

                codeBlocks.forEach(function(codeBlock) {
                    let html = codeBlock.innerHTML;

                    // 属性名称高亮 (包括引号)
                    html = html.replace(/"([^"]+)":/g, '<span class="token property">"$1":</span>');

                    // 字符串值高亮
                    html = html.replace(/: "([^"]+)"/g, ': <span class="token string">"$1"</span>');

                    // 数字高亮
                    html = html.replace(/: (\d+(\.\d+)?)/g, ': <span class="token number">$1</span>');

                    // 布尔值高亮
                    html = html.replace(/: (true|false)/g, ': <span class="token boolean">$1</span>');

                    // null值高亮
                    html = html.replace(/: (null)/g, ': <span class="token null">$1</span>');

                    codeBlock.innerHTML = html;
                });
            }

            // 代码行号生成函数
            function generateLineNumbers() {
                const codeBlocks = document.querySelectorAll('pre.line-numbers > code');
                
                codeBlocks.forEach(function(codeBlock) {
                    const parent = codeBlock.parentNode;
                    // 移除现有的行号
                    const existingLineNumbers = parent.querySelector('.line-numbers-rows');
                    if (existingLineNumbers) {
                        parent.removeChild(existingLineNumbers);
                    }
                    
                    // 创建新的行号
                    const lines = codeBlock.innerHTML.trim().split('\n');
                    const linesNum = lines.length+10;
                    let lineNumbersWrapper = document.createElement('span');
                    lineNumbersWrapper.setAttribute('class', 'line-numbers-rows');

                    for (let i = 0; i < linesNum; i++) {
                        let line = document.createElement('span');
                        lineNumbersWrapper.appendChild(line);
                    }
                    
                    parent.appendChild(lineNumbersWrapper);
                });
            }
            
            // 应用语法高亮
            highlightJson();
            
            // 页面加载完成后生成行号
            generateLineNumbers();
            
            // 窗口大小改变时重新生成行号
            $(window).resize(function() {
                generateLineNumbers();
            });
            
            // 页面加载完成后输出right-menu的初始位置信息
            if ($('.right-menu').length) {
                console.log('Initial Right Menu Info:', getElementScrollInfo('.right-menu'));
                
                // 初始化第一个菜单项的激活状态
                const firstMenuItem = $('.right-menu div').eq(1); // 跳过right-menu-active div
                if (firstMenuItem.length && !firstMenuItem.find('.right-menu-active-img').length) {
                    firstMenuItem.prepend('<img class="right-menu-active-img" src=/static/images/aival/left-tag.svg" alt="">');
                }
            }
        });
        
        // 复制代码功能
        function copyCodeToClipboard(button) {
            const codeBlock = button.closest('.code-block-container').querySelector('code');
            const textArea = document.createElement('textarea');
            textArea.value = codeBlock.textContent.trim();
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // 显示复制成功提示
            const originalText = button.querySelector('span').textContent;
            button.querySelector('span').textContent = '已复制';
            setTimeout(function() {
                button.querySelector('span').textContent = originalText;
            }, 2000);
        }

        $('#rebuild').click(function(){
            $('#rebuildConfirmModal').modal('show');
        })
        $('#continueRebuild').click(function(){
            $.ajax({
                url: "/user/get_token",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                success: function (data) {
                    showToast('success',data.msg)
                    setTimeout(function() {
                        location.reload()
                    }, 2000);

                }
            })
        })
    </script>
</body>
</html> 